ASF JIRA https://issues.apache.org/jira This file is an XML representation of an issue en-uk 8.20.10 820010 22-06-2022 [IGNITE-23551] Restarted node fails with NullPointerException https://issues.apache.org/jira/browse/IGNITE-23551 Ignite <p>We are using Ignite as a persistant caching system primarily to write KVs using the redis interface; we define redis caches statically in the xml config. </p> <p>We have been plagued by an issue where restarting a node in an existing stable cluster does not work and the node fails every time trying to join the cluster giving a NullPointerException. This happens with any and every node in the cluster and persists no matter how many times the node is started up.  After a full cluster restart the issue goes away. </p> <p> </p> <p>Following is the stacktrace we see in the logs of the failed node:</p> <div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent"> <pre class="code-java"> [10:51:34,769][SEVERE][tcp-disco-msg-worker-[fa915882 10.132.0.114:47500]-#2-#57][TcpDiscoverySpi] TcpDiscoverSpi's message worker thread failed abnormally. S topping the node in order to prevent cluster wide instability. java.lang.NullPointerException: Cannot invoke "org.apache.ignite.internal.managers.discovery.GridDiscoveryManager$CachePredicate.addClientNode(java.util.UUID,  <span class="code-object">boolean</span>)<span class="code-quote">" because "</span>p" is <span class="code-keyword">null</span>         at org.apache.ignite.internal.managers.discovery.GridDiscoveryManager.addClientNode(GridDiscoveryManager.java:428)         at org.apache.ignite.internal.processors.cache.ClusterCachesInfo.addReceivedClientNodesToDiscovery(ClusterCachesInfo.java:1600)         at org.apache.ignite.internal.processors.cache.ClusterCachesInfo.onGridDataReceived(ClusterCachesInfo.java:1519)         at org.apache.ignite.internal.processors.cache.GridCacheProcessor.onGridDataReceived(GridCacheProcessor.java:3137)         at org.apache.ignite.internal.managers.discovery.GridDiscoveryManager$4.onExchange(GridDiscoveryManager.java:1019)         at org.apache.ignite.spi.discovery.tcp.TcpDiscoverySpi.onExchange(TcpDiscoverySpi.java:2197)         at org.apache.ignite.spi.discovery.tcp.ServerImpl$RingMessageWorker.processNodeAddFinishedMessage(ServerImpl.java:5359)         at org.apache.ignite.spi.discovery.tcp.ServerImpl$RingMessageWorker.processMessage(ServerImpl.java:3242)         at org.apache.ignite.spi.discovery.tcp.ServerImpl$RingMessageWorker.processMessage(ServerImpl.java:2918)         at org.apache.ignite.spi.discovery.tcp.ServerImpl$MessageWorker.body(ServerImpl.java:8048)         at org.apache.ignite.spi.discovery.tcp.ServerImpl$RingMessageWorker.body(ServerImpl.java:3089)         at org.apache.ignite.internal.util.worker.GridWorker.run(GridWorker.java:125)         at org.apache.ignite.spi.discovery.tcp.ServerImpl$MessageWorkerThread.body(ServerImpl.java:7979)         at org.apache.ignite.spi.IgniteSpiThread.run(IgniteSpiThread.java:58) </pre> </div></div> <p>Attaching the config and logs for a test cluster for reference.</p> <p><span class="nobr"><a href="https://issues.apache.org/jira/secure/attachment/13072439/13072439_ignite-config.xml" title="ignite-config.xml attached to IGNITE-23551">ignite-config.xml<sup><img class="rendericon" src="https://issues.apache.org/jira/images/icons/link_attachment_7.gif" height="7" width="7" align="absmiddle" alt="" border="0"/></sup></a></span></p> <p><span class="nobr"><a href="https://issues.apache.org/jira/secure/attachment/13072438/13072438_ignite.log" title="ignite.log attached to IGNITE-23551">ignite.log<sup><img class="rendericon" src="https://issues.apache.org/jira/images/icons/link_attachment_7.gif" height="7" width="7" align="absmiddle" alt="" border="0"/></sup></a></span></p> <p>OS: Ubuntu/debian</p> <p>Java: Openjdk version "17.0.13" 2024-10-15</p> IGNITE-23551 Restarted node fails with NullPointerException Bug Major Open Unresolved Unassigned Ashu Pachauri Sat, 26 Oct 2024 11:42:10 +0000 Wed, 30 Oct 2024 19:29:20 +0000 2.15 2.16 cache 0 2 <p>This looks like a strange Java error because the signature of the method cited in the logged NPE does not match the code cited in the logged NPE.</p> <p>This asserts p != null, but this looks like the wrong signature<br/> <a href="https://github.com/apache/ignite/blob/f98f7f35de6dc76a9b69299154afaa2139a5ec6d/modules/core/src/main/java/org/apache/ignite/internal/managers/discovery/GridDiscoveryManager.java#L422" class="external-link" target="_blank" rel="nofollow noopener">https://github.com/apache/ignite/blob/f98f7f35de6dc76a9b69299154afaa2139a5ec6d/modules/core/src/main/java/org/apache/ignite/internal/managers/discovery/GridDiscoveryManager.java#L422</a></p> <p>This has a matching signature, and does not care about predicate p (cacheName) being null.<br/> <a href="https://github.com/apache/ignite/blob/f98f7f35de6dc76a9b69299154afaa2139a5ec6d/modules/core/src/main/java/org/apache/ignite/internal/managers/discovery/GridDiscoveryManager.java#L3425" class="external-link" target="_blank" rel="nofollow noopener">https://github.com/apache/ignite/blob/f98f7f35de6dc76a9b69299154afaa2139a5ec6d/modules/core/src/main/java/org/apache/ignite/internal/managers/discovery/GridDiscoveryManager.java#L3425</a></p> <p> </p> Attachment count 2.0 Development Enable Automatic Patch Review false Global Rank 9223372036854775807 Ignite Flags Docs Required Release Notes Required Last public comment date 1 day ago Rank 0|z1s81k: Rank (Obsolete) 9223372036854775807
